# Ohirun Bot 使い方

Ohirunは、お昼が決められない人のための Discord Bot です。登録した店舗と食べ物からランダムに組み合わせを提案してくれます。

## 主要機能

### 🍽️ お昼の提案
- ランダムな店舗と食べ物の組み合わせを提案
- 前日の提案と重複しないように配慮
- ユーザー別に履歴を管理

### 📝 データ管理
- 店舗の追加・管理
- 食べ物の追加・管理
- 店舗と食べ物の関連付け

## コマンド一覧

### `/ohiru`
お昼の提案をランダムに表示します。

```
/ohiru
```

**機能:**
- 利用可能な店舗と食べ物の組み合わせからランダム選択
- 前日の提案を避けて選択
- 店舗名、ジャンル、食べ物、種類を表示

---

### `/add`
店舗または食べ物を追加します。

#### 店舗の追加
```
/add store <店舗名> <ジャンル>
```

**例:**
```
/add store セブンイレブン コンビニ
/add store 吉野家 牛丼
```

#### 食べ物の追加
```
/add meal <食べ物名> <種類> [説明]
```

**食べ物の種類:**
- `1`: コメ（ご飯系）
- `2`: 麺（麺類）
- `3`: パン（パン系）

**例:**
```
/add meal おにぎり 1 ツナマヨおにぎり
/add meal ラーメン 2
/add meal サンドイッチ 3 ハムサンド
```

---

### `/list`
登録されているデータを表示します。

#### 店舗一覧の表示
```
/list stores
```

#### 食べ物一覧の表示
```
/list meals
```

#### 関連付け一覧の表示
```
/list links
```

**例:**
```
/list stores
→ 登録されている全店舗をID、名前、ジャンル付きで表示

/list meals
→ 登録されている全食べ物をID、名前、種類、説明付きで表示

/list links
→ 店舗と食べ物の関連付けを価格付きで表示
```

---

### `/link`
店舗と食べ物を関連付けます。

```
/link <店舗ID> <食べ物ID> [価格]
```

**例:**
```
/link 1 1 120
/link 2 3
```

**注意:**
- 店舗IDと食べ物IDは、それぞれ追加時に表示される番号を使用
- 価格は任意（円単位）

## 使用例

### 1. 初期セットアップ

```bash
# 店舗を追加
/add store セブンイレブン コンビニ
/add store ファミリーマート コンビニ
/add store 吉野家 牛丼

# 食べ物を追加
/add meal おにぎり 1 ツナマヨ
/add meal 弁当 1 のり弁
/add meal カップラーメン 2
/add meal パン 3 メロンパン

# 関連付け
/link 1 1 120  # セブンイレブンでおにぎり（120円）
/link 1 4 150  # セブンイレブンでパン（150円）
/link 2 1 118  # ファミマでおにぎり（118円）
/link 3 2 500  # 吉野家で弁当（500円）
```

### 2. お昼の提案

```bash
/ohiru
```

**出力例:**
```
🍽️ お昼の提案

セブンイレブンでおにぎりを買うといいでしょう！

店舗: セブンイレブン
ジャンル: コンビニ
食べ物: おにぎり
種類: コメ
```

## データベース構造

### 店舗 (Store)
- ID: 自動採番
- 名前: 店舗名
- ジャンル: 店舗のカテゴリ
- 有効フラグ: アクティブ状態

### 食べ物 (Meal)
- ID: 自動採番
- 名前: 食べ物名
- 種類: 1=コメ, 2=麺, 3=パン
- 説明: 任意の説明文

### 関連付け (StoreMeal)
- 店舗ID: 店舗の参照
- 食べ物ID: 食べ物の参照
- 価格: 任意の価格情報
- 利用可能フラグ: 提案対象かどうか

### 履歴 (LunchHistory)
- ユーザーID: Discord ユーザーID
- 店舗ID・食べ物ID: 提案された組み合わせ
- 提案日時: 提案された日時

## 注意事項

- コマンドはギルド（サーバー）ごとに登録されます
- データベースは SQLite を使用しているため、サーバー全体で共有されます
- 前日の提案回避は、ユーザー別に管理されます
- 店舗と食べ物の関連付けがない場合、提案は表示されません

## トラブルシューティング

### 「利用可能な店舗と食べ物の組み合わせがありません」
1. 店舗が登録されているか確認
2. 食べ物が登録されているか確認
3. `/link` で店舗と食べ物が関連付けられているか確認

### コマンドが表示されない
1. Bot に適切な権限が付与されているか確認
2. `applications.commands` スコープで招待されているか確認
3. ギルドコマンドの反映を待つ（通常は即座に反映）

## 環境設定

### 必要な環境変数
```bash
DISCORD_TOKEN=YOUR_BOT_TOKEN_HERE
```

### 設定ファイル (appsettings.json)
```json
{
  "Discord": {
    "Token": "YOUR_DISCORD_BOT_TOKEN_HERE"
  },
  "ConnectionStrings": {
    "DefaultConnection": "Data Source=ohirun.db"
  }
}
```